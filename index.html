<!DOCTYPE html>
<html>

    <head>
        <title>Jarvis - Canvas</title>
        <style>
            body { margin: 0; padding: 0; background: #fff; }
            #jarvis { width: 100%; height: 100%; }
        </style>
    </head>

    <body>
        <canvas id="jarvis"></canvas>


        <script>
            //https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3
            navigator.webkitGetUserMedia({audio:true}, function(stream){
                audioContext = new AudioContext();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                javascriptNode = audioContext.createScriptProcessor(1024, 1, 1);

                analyser.smoothingTimeConstant = 0.0;
                analyser.fftSize = 512;

                microphone.connect(analyser);
                analyser.connect(javascriptNode);
                javascriptNode.connect(audioContext.destination);

                canvasContext = document.getElementById("jarvis");
                canvasContext= canvasContext.getContext("2d");

                javascriptNode.onaudioprocess = function() {
                    var array =  new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(array);
                    var values = 0;

                    var length = array.length;
                    for (var i = 0; i < length; i++) {
                        values += array[i];
                    }

                    var average = values / length;
                    canvasContext.clearRect(0, 0, 150, 300);
                    canvasContext.fillStyle = '#00ff00';
                    canvasContext.fillRect(0,130-average,25,140);
                }

            }, function(e){ console.log(e); });
        </script>
    </body>

</html>