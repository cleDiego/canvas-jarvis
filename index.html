<!DOCTYPE html>
<html>

    <head>
        <title>Jarvis - Canvas</title>
        <style>
            body { margin: 0; padding: 0; background: #fff; }
        </style>
    </head>

    <body>
        <div class="content">
            <canvas id="jarvis"></canvas>
        </div>

        <script>
            //https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3
            navigator.webkitGetUserMedia({audio:true}, function(stream){

                canvas = document.getElementById("jarvis");
                canvasContext = canvas.getContext("2d");

                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                javascriptNode = audioContext.createScriptProcessor(1024, 1, 1);
                analyser.fftSize = 2048*2;
                analyser.smoothingTimeConstant = 1;

                microphone.connect(analyser);
                analyser.connect(javascriptNode);
                javascriptNode.connect(audioContext.destination);

                javascriptNode.onaudioprocess = function() {
                    var array =  new Float32Array(analyser.frequencyBinCount);
                    analyser.getFloatTimeDomainData(array);

                    canvas.width = array.length;
                    canvas.height = window.innerHeight;

                    canvasContext.clearRect(0, 0, canvas.width, canvas.height);
                    canvasContext.beginPath();

                    for (let i = 0; i < array.length; i++) {
                        const x = i;
                        const y = (0.5 + (array[i] / 2)) * canvas.height;
                        if (i == 0) {
                            canvasContext.moveTo(x, y);
                        } else {
                            canvasContext.lineTo(x, y);
                        }
                    }

                    canvasContext.strokeStyle = '#000';
                    canvasContext.lineWidth = 2;
                    canvasContext.stroke();

                    /*
                    canvasContext.clearRect(0, 0, 500, 500);
                    var length = array.length;
                    var left = 0;
                    for (var i = 0; i < length; i++) {
                        canvasContext.fillStyle = '#ccc';
                        canvasContext.fillRect(left, 0, 2, array[i]);
                        left += 1;
                    }*/
                }

            }, function(e){ console.log(e); });
        </script>
    </body>

</html>